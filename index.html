<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TON Spin Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/@tonconnect/sdk@0.9.12/dist/tonconnect.min.js"></script>
</head>
<body>
  <h2>Spin the Wheel</h2>
  <button id="payBtn">Pay 0.0001 TON & Get Spin</button>
  <button id="spinBtn" disabled>ğŸ¡ Spin Now</button>
  <div id="result"></div>
  <div id="spinsLeft"></div>

  <script>
    const BACKEND_URL = "https://ton-check.onrender.com/"; // Õ¤Õ¸Ö‚Ö€Õ« Ö„Õ¸ Render backend URL
    const RECEIVER = "UQBfrU75WGhBLnRpBs1ImWE5sPdxKsFMBgogpD578JxXyDbK"; // Ö„Õ¸ TON wallet Õ°Õ¡Õ½ÖÕ¥Õ¶
    const AMOUNT = 100000; // 0.0001 TON in nanoton

    // Init TonConnect
    const tonconnect = new TonConnect();

    // Load spins from localStorage
    let spins = parseInt(localStorage.getItem("spins") || "0");
    updateSpins();

   document.getElementById("payBtn").addEventListener("click", async () => {
  try {
    // Open wallet & send transaction
    const tx = await tonconnect.sendTransaction({
      to: RECEIVER,
      value: AMOUNT
    });

    const txHash = tx.hash; 
    console.log("Transaction hash:", txHash);

    // Send to backend for verification
    const res = await fetch(`${BACKEND_URL}/check-payment`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ txHash })
    });

    const data = await res.json();

    if (data.success) {
      spins++;
      localStorage.setItem("spins", spins);
      updateSpins();
      document.getElementById("result").innerText = "âœ… Payment verified! 1 spin added!";
      
      // Ô±Õ¾Õ¿Õ¸Õ´Õ¡Õ¿ Õ¡Õ¯Õ¿Õ«Õ¾Õ¡ÖÕ¶Õ¸Ö‚Õ´ Õ¥Õ¶Ö„ spin Õ¯Õ¸Õ³Õ¡Õ¯Õ¨
      document.getElementById("spinBtn").disabled = false;
    } else {
      document.getElementById("result").innerText = "âŒ Payment not verified!";
    }
  } catch (err) {
    console.error(err);
    document.getElementById("result").innerText = "âŒ Payment cancelled or failed!";
  }
});



    // Spin button
    document.getElementById("spinBtn").addEventListener("click", () => {
      if (spins > 0) {
        spins--;
        localStorage.setItem("spins", spins);
        updateSpins();
        alert("ğŸ¡ Wheel is spinning...");
      } else {
        alert("âŒ You donâ€™t have spins left!");
      }
    });

    function updateSpins() {
      document.getElementById("spinsLeft").innerText = `Spins left: ${spins}`;
      document.getElementById("spinBtn").disabled = spins <= 0;
    }
  </script>
</body>
</html>
